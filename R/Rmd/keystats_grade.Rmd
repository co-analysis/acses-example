---
title: "Civil servants by grade"
date: 2021-01-01
section: keystats
weight: 100
summary: "Headline statistics of Civil Servants by grade"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)

data_dir <- file.path(dirname(getwd()), "data")

cs19 <- read_csv(file.path(data_dir, "Statistical-tables-Civil-Service-Statistics-2019-machine-readable-headcounts-version-V2.csv"))

cs19t1_all <- cs19 |> 
  filter(table == "t1" & category_2 == "All employees") |>
  transmute(
    grade = category_1,
    sex = category_3,
    value = as.numeric(value)
  ) |>
  pivot_wider(names_from = sex, values_from = value) |>
  janitor::clean_names() |>
  mutate(
    grade = factor(grade,
                   levels = c("Administrative Officers and Assistants",
                              "Executive Officers",
                              "Senior and Higher Executive Officers",
                              "Grades 6 and 7",
                              "Senior Civil Service Level",
                              "Not reported",
                              "All employees")),
    pc_female = female/(female + male),
    totaliser = if_else(grade == "All employees", 
                        NA, TRUE),
    pc_grade = total/sum(total * totaliser, na.rm = TRUE) * totaliser
  ) |>
  arrange(grade) |>
  select(grade, female, male, unknown, total, pc_female, pc_grade)

cs19t1_all_gdf <- cs19 |>
  filter(table == "t1" & 
           category_1 != "All employees" &
           category_2 == "All employees" & 
           category_3 %in% c("Female", "Male")) |>
  transmute(
    grade = category_1,
    sex = category_3,
    value = as.numeric(value)
  ) |>
  mutate(
    grade = factor(grade,
                   levels = c("Not reported",
                              "Administrative Officers and Assistants",
                              "Executive Officers",
                              "Senior and Higher Executive Officers",
                              "Grades 6 and 7",
                              "Senior Civil Service Level")),
    y_value = if_else(sex == "Female", -value, value),
    label_text = scales::comma(value, 1),
    label_y = case_when(
      grade == "Senior Civil Service Level" & sex == "Female" ~ -value - 1000,
      grade == "Senior Civil Service Level" & sex == "Male" ~ value + 1000,
      grade == "Not reported" & sex == "Female" ~ -value - 1000,
      grade == "Not reported" & sex == "Male" ~ value + 1000,
      sex == "Female" ~ -value + 1000,
      sex == "Male" ~ value - 1000
    ),
    label_hjust = case_when(
      grade == "Senior Civil Service Level" & sex == "Female" ~ 1,
      grade == "Senior Civil Service Level" & sex == "Male" ~ 0,
      grade == "Not reported" & sex == "Female" ~ 1,
      grade == "Not reported" & sex == "Male" ~ 0,
      sex == "Female" ~ 0,
      sex == "Male" ~ 1
    ),
    label_colour = case_when(
      grade == "Senior Civil Service Level" & sex == "Female" ~ "outer-female",
      grade == "Senior Civil Service Level" & sex == "Male" ~ "outer-male",
      grade == "Not reported" & sex == "Female" ~ "outer-female",
      grade == "Not reported" & sex == "Male" ~ "outer-male",
      TRUE ~ "inner"
    )
  )

```

{{< warning "This is a prototype based on data from the 2019 statistics." >}}


Administrative staff comprised just over a third of civil servants (33.6%) in 2019, compared to almost a half (47.1%) in 2011. There are now 5,970 civil servants working at the Senior Civil Service level, which equates to 1.3% of the Civil Service.

Overall, 53.9% of civil servants are female, however this varies noticeably by grade. More than half of civil servants at administrative and executive officer grades are female (57.2% and 56.1% respectively), while less than of those in Grade 6 and & or at Senior Civil Service level are female (46.9% and 44.7% respectively).

```{r graph}
p <- ggplot(cs19t1_all_gdf, aes(x = grade, y = y_value, fill = sex)) +
  geom_col() +
  geom_text(aes(label = label_text, y = label_y, hjust = label_hjust, 
                colour = label_colour), size = 3, show.legend = FALSE) +
  scale_x_discrete(labels = scales::label_wrap(20)) +
  scale_fill_manual(
    values = c("Female" = "#1d70b8", "Male" = "#d4351c"),
    guide = guide_legend(title = "Sex")) +
  scale_colour_manual(values = c("inner" = "#ffffff", 
                                 "outer-female" = "#1d70b8",
                                 "outer-male" = "#d4351c")) +
  coord_flip() +
  theme_minimal() +
  theme(
    text = element_text(colour = "#0b0c0c"),
    title = element_text(size = 9, face = "bold"), 
    plot.title.position = "plot",
    panel.grid = element_blank(),
    axis.title = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_text(size = 9),
    legend.position = "bottom",
    legend.key.size = unit(8, "pt"),
    legend.text = element_text(size = 9)
  )

govukhugo::render_svg(plot = p, 400, 300, 
                      alt_title = "Civil Service grade by sex",
                      caption = "alt_title")
```

:::{.data-card}

```{r}

govukhugo::govuk_datatable(
  cs19t1_all,
  col_names = c("Grade", "Female", "Male", "Unknown", "Total", "Percent female",
                "Percent grade"),
  search = FALSE
  ) |>
  DT::formatRound(2:5, digits = 0) |>
  DT::formatPercentage(6:7, digits = 1)

```

:::

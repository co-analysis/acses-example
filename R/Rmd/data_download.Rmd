---
title: "Data download"
date: 2021-01-01
section: data
weight: 100
summary: "Download the CS statistics data"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)

data_dir <- file.path(dirname(getwd()), "data")

cs19 <- read_csv(file.path(data_dir, "Statistical-tables-Civil-Service-Statistics-2019-machine-readable-headcounts-version-V2.csv"))

cs19_sub <- cs19 |>
  filter(table %in% c("t1", "t2", "t3", "t4")) |>
  mutate(
    value = as.numeric(value),
    working_pattern = case_when(
      table == "t1" ~ category_2,
      TRUE ~ "All employees"
    ),
    sex = case_when(
      table == "t1" & category_3 == "Total" ~ "All employees",
      table == "t1" ~ category_3,
      TRUE ~ "All employees"
    ),
    ethnicity = case_when(
      table == "t2" ~ category_2,
      TRUE ~ "All employees"
    ),
    disability = case_when(
      table == "t3" ~ category_2,
      TRUE ~ "All employees"
    ),
    age = case_when(
      table == "t4" ~ category_2,
      TRUE ~ "All employees"
    ),
    grade = category_1,
    table = case_when(
      table == "t1" ~ "T1: CS employment by responsibility level and sex",
      table == "t2" ~ "T2: CS employment by responsibility level and ethnicity",
      table == "t3" ~ "T3: CS mployment by responsibility level and disability",
      table == "t4" ~ "T4: CS employment by responsiblity level and age band",
    )
  ) |>
  select(table, grade, working_pattern, sex, age, ethnicity, disability, value)

cs19_sub_sd <- crosstalk::SharedData$new(cs19_sub)

fs_table <- crosstalk::filter_select(
  "fs_table",
  label = "Table",
  group = ~table,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

fs_grade <- crosstalk::filter_select(
  "fs_grade",
  label = "Grade",
  group = ~grade,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

fs_sex <- crosstalk::filter_select(
  "fs_sex",
  label = "Sex",
  group = ~sex,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

fs_age <- crosstalk::filter_select(
  "fs_age",
  label = "Age band",
  group = ~age,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

fs_ethnicity <- crosstalk::filter_select(
  "fs_ethnicity",
  label = "Ethnicity",
  group = ~ethnicity,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

fs_disability <- crosstalk::filter_select(
  "fs_disability",
  label = "Disability status",
  group = ~disability,
  sharedData = cs19_sub_sd,
  multiple = FALSE)

```


{{< warning "This is a prototype based on data from the 2019 statistics." >}}

From this page you can download the raw statistical tables that make up the Civil Service Statistics. You can download the full file, or use the interactive table below to filter the data and select only the tables of interest.

```{=html}
{{< download_file link="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/836368/Statistical-tables-Civil-Service-Statistics-2019-machine-readable-headcounts-version-V2.csv" text="Complete machine readable format tables for Civil Service Statistics 2019" type="CSV" size="3.8MB" >}}
```

You can use the filters and table below to create your own subset of the Civil Service Statistics to extract only the data you're interested in. The copy button will copy the data to your clipboard so you can paste it into another application (such as a spreadsheet). The CSV button allows you to download the filtered table as a comma separated values file.

:::{.loading}
{{< warning "Loading table..." >}}
:::

::::{.govuk-grid-row .data-card}

:::{.govuk-grid-column-one-quarter .data-filters .govuk-body-s}

<span class="govuk-heading-s">Filters</span>

```{r selector, echo=FALSE}
fs_table
fs_grade
fs_sex
fs_ethnicity
fs_disability
govukhugo::clear_filters()
```

:::

:::{.govuk-grid-column-three-quarters .data-display}

```{r}

govukhugo::govuk_datatable(
  cs19_sub_sd,
  small_text = TRUE,
  col_names = c("Grade", "Working pattern", "Sex", "Age band", "Ethnicity",
                "Disability status", "Headcount"),
  search = FALSE,
  col_defs = list(
    list(
      visible = FALSE,
      targets = list(0)))
  ) |>
  DT::formatRound(8, digits = 0)

```

:::

::::

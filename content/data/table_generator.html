---
title: Table generator
date: 2021-01-01
weight: 999
summary: Filter and extract the data you are interested in
rmarkdown: true
---

<p class="govuk-body">From this page you can filter the raw statistical tables that make up the Civil Service
    Statistics.</p>
<p class="govuk-body">Use the filters to create your own subset of the machine readable tables. Please note this results
    in a wide table that you will need to scroll horizontally to view in full. You can copy the table to the clipboard
    or download your select as a CSV.</p>

<hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">

<div id="filter_group" class="govuk-form-group">
    <fieldset class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h3 class="govuk-fieldset__heading">
                Select your data filters
            </h3>
        </legend>
        <div class="govuk-form-group">
            <label class="govuk-label" for="filter_source_table">
                Source table
            </label>
            <select class="govuk-select" id="filter_source_table" name="filter_source_table">
                <option value="null">Please select a table</option>
                <option value="table_01">Table 1: Civil Service employment by responsibility level and sex</option>
                <option value="table_02">Table 2: Civil Service employment by responsibility level and ethnicity
                </option>
                <option value="table_03">Table 3: Civil Service employment by disability status and responsibility level
                </option>
                <option value="table_04">Table 4: Civil Service employment by age band and responsibility level</option>
                <option value="table_04a">Table 4A: Median age by responsibility level</option>
                <option value="table_05">Table 5: Civil Service employment by national identity and responsibility level
                </option>
                <option value="table_06">Table 6: Civil Service employment by gross salary band and sex</option>
                <option value="table_06a">Table 6A: Summary salary statistics by sex</option>
                <option value="table_07">Table 7: Median salary for employees by responsibility level and sex</option>
                <option value="table_08">Table 8: Civil Service employment; profession by government department</option>
                <option value="table_08a">Table 8A: Civil Service employment (FTE); profession by government department
                </option>
                <option value="table_09">Table 9: Entrants and leavers to the Civil Service by sex and responsibility
                    level</option>
                <option value="table_10">Table 10: Regional distribution of Civil Service employment</option>
                <option value="table_11">Table 11: Civil Service employment; Reconciliation of annual and quarterly
                    statistics</option>
                <option value="table_12">Table 12: Civil Service employment; regional distribution by government
                    department</option>
                <option value="table_13">Table 13: Civil Service employment; regional distribution</option>
                <option value="table_14">Table 14: Civil Service employment; regional (NUTS 2) distribution</option>
                <option value="table_15">Table 15: Civil Service employment; regional (NUTS 3) distribution</option>
                <option value="table_16">Table 16: Civil Service employment; by region, responsibility level and sex
                </option>
                <option value="table_17">Table 17: Civil Service employment; by region, responsibility level and
                    ethnicity</option>
                <option value="table_18">Table 18: Civil Service employment; by region, responsibility level and
                    disability status</option>
                <option value="table_19">Table 19: Civil Service employment by country and age band</option>
                <option value="table_19a">Table 19A: Civil Service employment by region and age band</option>
                <option value="table_20">Table 20: Civil Service employment; responsibility level by government
                    department</option>
                <option value="table_21">Table 21: Civil Service employment; responsibility level by government
                    department</option>
                <option value="table_22">Table 22: Civil Service employment by responsibility level, government
                    department and sex</option>
                <option value="table_23">Table 23: Civil Service employment by responsibility level, age band and sex
                </option>
                <option value="table_24">Table 24: Mean salary for employees by responsibility level and sex</option>
                <option value="table_25">Table 25: Median salary by responsibility level and government department
                </option>
                <option value="table_26">Table 26: Median salary by country and responsibility level</option>
                <option value="table_26a">Table 26A: Median salary by region and responsibility level </option>
                <option value="table_27">Table 27: Median salary by ethnicity and responsibility level</option>
                <option value="table_28">Table 28: Median salary by disability status and responsibility level</option>
                <option value="table_29">Table 29: Median salary by department and sex (full-time employees)</option>
                <option value="table_29a">Table 29A: Mean salary by department and sex (full-time employees)</option>
                <option value="table_30">Table 30: Median and mean salary by department and sex (part-time employees)
                </option>
                <option value="table_30a">Table 30A: Mean salary by department and sex (part-time employees)</option>
                <option value="table_31">Table 31: Median salary by department and sex</option>
                <option value="table_31a">Table 31: Mean salary by department and sex</option>
                <option value="table_32">Table 32: Median salary by responsibility level, government department and sex
                </option>
                <option value="table_33">Table 33: Mean salary by responsibility level, government department and sex
                </option>
                <option value="table_34">Table 34: Percentage difference in median Civil Service pay by sex</option>
                <option value="table_35">Table 35: Civil servant salaries in excess of a) £100,000 b) £150,000 and c)
                    £200,000 per annum</option>
                <option value="table_36">Table 36: Civil Service employment; Percentage of male and female employees by
                    department</option>
                <option value="table_37">Table 37: Civil Service employment by government department and ethnicity
                </option>
                <option value="table_38">Table 38: Civil Service employment by government department and disability
                    status</option>
                <option value="table_39">Table 39: Civil Service employment by government department and age band
                </option>
                <option value="table_40">Table 40: Civil Service entrants and leavers by government department and sex
                </option>
                <option value="table_41">Table 41: Civil Service entrants and leavers by government department and
                    ethnicity</option>
                <option value="table_42">Table 42: Civil Service leavers by government department and leaving cause
                </option>
                <option value="table_43">Table 43: Civil Service internal transfers by government department</option>
                <option value="table_44">Table 44: Civil Service employment; Percentage of male and female employees
                    working part-time by age band</option>
                <option value="table_45">Table 45: Lower quartile, median, and upper quartile of salary by profession
                </option>
                <option value="table_46">Table 46: Civil Service employment; percentage working part-time by department
                </option>
                <option value="table_47">Table 47: Civil Service employment; regional distribution by profession
                </option>
                <option value="table_a1">Table A1: Civil Service employment by sexual orientation and department
                </option>
                <option value="table_a2">Table A2: Civil Service employment by sexual orientation and responsibility
                    level</option>
                <option value="table_a3">Table A3: Civil Service employment by religion or belief and department
                </option>
                <option value="table_a4">Table A4: Civil Service employment by religion or belief and responsibility
                    level</option>
                <option value="table_B">Table B: Civil Service employment; ratio of highest earner against all employees
                    median salaries by department</option>
                <option value="table_d1">Table D1: Civil Service employment; Function by government department</option>
                <option value="table_d2">Table D2: Civil Service employment; Function by government department</option>
                <option value="table_d3">Table D3: Lower quartile, median, and upper quartile of salary by function
                </option>
                <option value="table_d4">Table D4: Civil Service employment; regional distribution by function</option>
            </select>
        </div>
        <div class="govuk-form-group" id="filter_variable_group" style="display:none">
            <label class="govuk-label" for="filter_variable">
                Variable
            </label>
            <select class="govuk-select" id="filter_variable" name="filter_variable">
            </select>
        </div>
        <div class="govuk-form-group" id="filter_categories_group" style="display:none">
            <label class="govuk-label" for="filter_categories">
                Categories
            </label>
            <select class="govuk-select" id="filter_categories" name="filter_categories">
            </select>
        </div>
        <div class="govuk-form-group">
        <button href="#" role="button" draggable="false" class="govuk-button" data-module="govuk-button"
            id="add_category" style="display:none">Add category to filters</button>
        </div>
    </fieldset>

    <div id="filter_selections" style="display:none">
        <h4>No filters selected</h4>
    </div>
    <button href="#" role="button" draggable="false" class="govuk-button govuk-button--secondary"
        data-module="govuk-button" id="reset_filters" style="display:none">Reset filters</button>

    <hr class="govuk-section-break govuk-section-break--l">

    <button id="generate_table" href="#" role="button" draggable="false" class="govuk-button govuk-button--start"
        data-module="govuk-button" style="display:none">
        Generate table
        <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19"
            viewBox="0 0 33 40" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z" />
        </svg></button>
</div>

<div id="no_results" class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert"
    data-module="govuk-error-summary" style="display:none">
    <h2 class="govuk-error-summary__title" id="error-summary-title">
        There is a problem
    </h2>
    <div class="govuk-error-summary__body">
        <p class="govuk-error-message"><span class="govuk-visually-hidden">Error:</span> Your selections resulted in no
            data.</p>
    </div>
</div>

<div id="filter_results" style="display:none;">
    <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">
    <h3 class="govuk-heading-l">Generated table</h3>
    <div class="govuk-grid-row data-card">
        <div class="govuk-grid-column-full data-display">
            <div id="results_meta" class="govuk-body">
                <p id="results_meta_table"></p>
                <p id="results_meta_categories"></p>
            </div>
            <div id="results_container" class="govuk-!-font-size-14"></div>
        </div>
    </div>
</div>

<script>
    let csv_data = [];
    let filter_res = [];
    let csv_columns = [];
    let var_selected = "";
    let category_selections = {
        age_band: "",
        appointment_status: "",
        country: "",
        disability: "",
        ethnicity: "",
        flow: "",
        function_of_post: "",
        leaver_cause: "",
        national_identity: "",
        nuts2: "",
        nuts3: "",
        organisation: "",
        profession_of_post: "",
        religion_or_belief: "",
        responsibility_level: "",
        salary_band: "",
        sex: "",
        sexual_orientation: "",
        transfer_type: "",
        uk_region: "",
        working_pattern: ""
    };
    let number_of_selections = 0;

    Papa.parse(
        "../../files/acses2021_processed.csv", {
            header: true,
            download: true,
            complete: function (results, file) {
                csv_data = results.data;
                csv_columns = Object.keys(csv_data[0]);
            }
        }
    );

    let table_variables = {
        table_01: ["responsibility_level", "sex", "working_pattern"],
        table_02: ["ethnicity", "responsibility_level"],
        table_03: ["disability", "responsibility_level"],
        table_04: ["age_band", "responsibility_level"],
        table_04a: ["responsibility_level"],
        table_05: ["national_identity", "responsibility_level"],
        table_06: ["salary_band", "sex", "working_pattern"],
        table_06a: ["sex", "working_pattern"],
        table_07: ["responsibility_level", "sex", "working_pattern"],
        table_08: ["organisation", "profession_of_post"],
        table_08a: ["organisation", "profession_of_post"],
        table_09: ["flow", "responsibility_level", "sex"],
        table_10: ["appointment_status", "country"],
        table_10a: ["appointment_status", "uk_region"],
        table_12: ["organisation", "uk_region"],
        table_13: ["appointment_status", "country", "sex", "working_pattern"],
        table_13a: ["appointment_status", "sex", "uk_region", "working_pattern"],
        table_14: ["appointment_status", "nuts2", "sex", "working_pattern"],
        table_15: ["appointment_status", "nuts3", "sex", "working_pattern"],
        table_16: ["responsibility_level", "sex", "uk_region"],
        table_17: ["ethnicity", "responsibility_level", "uk_region"],
        table_18: ["disability", "responsibility_level", "uk_region"],
        table_19: ["age_band", "country"],
        table_19a: ["age_band", "uk_region"],
        table_20: ["organisation", "responsibility_level"],
        table_21: ["organisation", "responsibility_level"],
        table_22: ["organisation", "responsibility_level", "sex"],
        table_23: ["age_band", "responsibility_level", "sex"],
        table_24: ["responsibility_level", "sex", "working_pattern"],
        table_25: ["organisation", "responsibility_level"],
        table_26: ["country", "responsibility_level"],
        table_26a: ["responsibility_level", "uk_region"],
        table_27: ["ethnicity", "responsibility_level"],
        table_28: ["disability", "responsibility_level"],
        table_29: ["organisation", "sex", "working_pattern"],
        table_29a: ["organisation", "sex", "working_pattern"],
        table_30: ["organisation", "sex", "working_pattern"],
        table_30a: ["organisation", "sex", "working_pattern"],
        table_31: ["organisation", "sex", "working_pattern"],
        table_31a: ["organisation", "sex", "working_pattern"],
        table_32: ["organisation", "responsibility_level", "sex", "working_pattern"],
        table_33: ["organisation", "responsibility_level", "sex", "working_pattern"],
        table_35: ["salary_band", "working_pattern"],
        table_37: ["ethnicity", "organisation"],
        table_38: ["ethnicity", "organisation"],
        table_39: ["age_band", "organisation"],
        table_40: ["flow", "organisation", "sex"],
        table_41: ["ethnicity", "flow", "organisation"],
        table_42: ["leaver_cause", "organisation"],
        table_43: ["organisation", "transfer_type"],
        table_45: ["profession_of_post"],
        table_47: ["profession_of_post", "uk_region"],
        table_a1: ["organisation", "sexual_orientation"],
        table_a2: ["responsibility_level", "sexual_orientation"],
        table_a3: ["organisation", "religion_or_belief"],
        table_a4: ["religion_or_belief", "responsibility_level"],
        table_b: ["organisation"],
        table_d1: ["function_of_post", "organisation"],
        table_d2: ["function_of_post", "organisation"],
        table_d3: ["function_of_post"],
        table_d4: ["function_of_post", "uk_region"]
    }

    let variable_labels = {
        age_band: "Age band",
        appointment_status: "Appointment status",
        country: "Country",
        disability: "Disability",
        ethnicity: "Ethnicity",
        flow: "Flow",
        function_of_post: "Function of post",
        leaver_cause: "Leaver cause",
        national_identity: "National identity",
        nuts2: "NUTS2",
        nuts3: "NUTS3",
        organisation: "Organisation",
        profession_of_post: "Profession of post",
        religion_or_belief: "Religion or belief",
        responsibility_level: "Responsibility level",
        salary_band: "Salary band",
        sex: "Sex",
        sexual_orientation: "Sexual orientation",
        transfer_type: "Transfer type",
        uk_region: "UK region",
        working_pattern: "Working pattern",
    }

    let variable_categories = {
        age_band: ["16-19", "20-29", "30-39", "40-49", "50-59", "60-64", "65 & over", "Not reported",
            "All employees"
        ],
        appointment_status: ["Permanent", "Temporary", "All employees"],
        country: ["England", "Wales", "Scotland", "Northern Ireland", "Overseas", "Not reported", "All employees"],
        disability: ["Disabled", "Non-disabled", "Not declared", "Not reported", "All declared", "All employees"],
        ethnicity: ["White", "Asian", "Black", "Chinese", "Mixed", "Other", "Not declared", "Not reported",
            "All declared", "Ethnic minority", "Other ethnicity", "Ethnicy minority", "All employees"
        ],
        flow: ["Entrants", "Leavers", "All employees"],
        function_of_post: ["Analysis", "Commercial", "Communications", "Counter Fraud", "Debt",
            "Digital, Data & Technology", "Finance", "Grants Management", "Human Resources", "Internal Audit",
            "Legal", "Project Delivery", "Property", "Security", "No function", "Not reported", "All employees"
        ],
        leaver_cause: ["Retirement", "Death in service", "Resignation",
            "End Of Casual, Period, Conditional Or Provisional Appointment", "Dismissal",
            "Transfer Of Function To Private Sector", "Secondment To Organisation External To Civil Service",
            "Transfer To Non-Civil Service Public Sector", "Voluntary Exit Scheme: With Payment",
            "Voluntary Exit Scheme: With An Unreduced Pension", "Voluntary Exit Scheme: Terms Not Recorded",
            "Voluntary Redundancy Scheme: With Payment",
            "Voluntary Redundancy Scheme: With An Unreduced Pension",
            "Voluntary Redundancy Scheme: Terms Not Recorded", "Compulsory Redundancy Scheme",
            "Other Leaving Cause", "Unknown Leaving Cause", "All employees"
        ],
        national_identity: ["British or Mixed British", "English", "Northern Irish", "Scottish", "Welsh",
            "Other national identity", "Not declared", "Not reported", "All employees"
        ],
        nuts2: ["Tees Valley and Durham", "Northumberland and Tyne and Wear", "Cumbria", "Greater Manchester",
            "Lancashire", "Cheshire", "Merseyside", "East Yorkshire and Northern Lincolnshire",
            "North Yorkshire", "South Yorkshire", "West Yorkshire", "Derbyshire and Nottinghamshire",
            "Leicestershire, Rutland and Northamptonshire", "Lincolnshire",
            "Herefordshire, Worcestershire and Warwickshire", "Shropshire and Staffordshire", "West Midlands",
            "East Anglia", "Bedfordshire and Hertfordshire", "Essex", "Inner London - West",
            "Inner London - East", "Outer London - East and North East", "Outer London - South",
            "Outer London - West and North West", "Berkshire, Buckinghamshire and Oxfordshire",
            "Surrey, East and West Sussex", "Hampshire and Isle of Wight", "Kent",
            "Gloucestershire, Wiltshire and Bath/Bristol area", "Dorset and Somerset",
            "Cornwall and Isles of Scilly", "Devon", "West Wales and The Valleys", "East Wales",
            "North Eastern Scotland", "Highlands and Islands", "Eastern Scotland", "West Central Scotland",
            "Southern Scotland", "Northern Ireland", "Overseas", "Not reported", "All employees"
        ],
        nuts3: ["Hartlepool and Stockton-on-Tees", "South Teesside", "Darlington", "Durham CC", "Northumberland",
            "Tyneside", "Sunderland", "West Cumbria", "East Cumbria", "Manchester",
            "Greater Manchester South West", "Greater Manchester South East", "Greater Manchester North West",
            "Greater Manchester North East", "Blackburn with Darwen", "Blackpool", "Lancaster and Wyre",
            "Mid Lancashire", "East Lancashire", "Chorley and West Lancashire", "Warrington", "Cheshire East",
            "Cheshire West and Chester", "East Merseyside", "Liverpool", "Sefton", "Wirral",
            "Kingston upon Hull, City of", "East Riding of Yorkshire", "North and North East Lincolnshire",
            "York", "North Yorkshire CC", "Barnsley, Doncaster and Rotherham", "Sheffield", "Bradford", "Leeds",
            "Calderdale and Kirklees", "Wakefield", "Derby", "East Derbyshire", "South and West Derbyshire",
            "Nottingham", "North Nottinghamshire", "South Nottinghamshire", "Leicester",
            "Leicestershire CC and Rutland", "West Northamptonshire", "North Northamptonshire", "Lincolnshire",
            "Herefordshire, County of", "Worcestershire", "Warwickshire", "Telford and Wrekin", "Shropshire CC",
            "Stoke-on-Trent", "Staffordshire CC", "Birmingham", "Solihull", "Coventry", "Dudley", "Sandwell",
            "Walsall", "Wolverhampton", "Peterborough", "Cambridgeshire CC", "Suffolk",
            "Norwich and East Norfolk", "North and West Norfolk", "Breckland and South Norfolk", "Luton",
            "Hertfordshire", "Bedford", "Central Bedfordshire", "Southend-on-Sea", "Thurrock",
            "Essex Haven Gateway", "West Essex", "Heart of Essex", "Essex Thames Gateway",
            "Camden and City of London", "Westminster", "Kensington & Chelsea and Hammersmith & Fulham",
            "Wandsworth", "Hackney and Newham", "Tower Hamlets", "Haringey and Islington",
            "Lewisham and Southwark", "Lambeth", "Bexley and Greenwich", "Barking & Dagenham and Havering",
            "Redbridge and Waltham Forest", "Enfield", "Bromley", "Croydon",
            "Merton, Kingston upon Thames and Sutton", "Barnet", "Brent", "Ealing", "Harrow and Hillingdon",
            "Hounslow and Richmond upon Thames", "Berkshire", "Milton Keynes", "Buckinghamshire CC",
            "Oxfordshire", "Brighton and Hove", "East Sussex CC", "West Surrey", "East Surrey",
            "West Sussex (South West)", "West Sussex (North East)", "Portsmouth", "Southampton",
            "Isle of Wight", "South Hampshire", "Central Hampshire", "North Hampshire", "Medway",
            "Kent Thames Gateway", "East Kent", "Mid Kent", "West Kent", "Bristol, City of",
            "Bath and North East Somerset, North Somerset and South Gloucestershire", "Gloucestershire",
            "Swindon", "Wiltshire", "Bournemouth and Poole", "Dorset CC", "Somerset",
            "Cornwall and Isles of Scilly", "Plymouth", "Torbay", "Devon CC", "Isle of Anglesey", "Gwynedd",
            "Conwy and Denbighshire", "South West Wales", "Central Valleys", "Gwent Valleys",
            "Bridgend and Neath Port Talbot", "Swansea", "Monmouthshire and Newport",
            "Cardiff and Vale of Glamorgan", "Flintshire and Wrexham", "Powys",
            "Aberdeen City and Aberdeenshire", "Caithness and Sutherland and Ross and Cromarty",
            "Inverness and Nairn and Moray, Badenoch and Strathspey",
            "Lochaber, Skye and Lochalsh, Arran and Cumbrae and Argyll and Bute", "Na h-Eileanan Siar",
            "Orkney Islands", "Shetland Islands", "Angus and Dundee City", "Clackmannanshire and Fife",
            "East Lothian and Midlothian", "City of Edinburgh", "Falkirk", "Perth and Kinross and Stirling",
            "West Lothian", "East Dunbartonshire, West Dunbartonshire and Helensburgh and Lomond",
            "Glasgow City", "Inverclyde, East Renfrewshire and Renfrewshire", "North Lanarkshire",
            "Scottish Borders", "Dumfries and Galloway", "East Ayrshire and North Ayrshire mainland",
            "South Ayrshire", "South Lanarkshire", "Belfast", "Armagh City, Banbridge and Craigavon",
            "Newry, Mourne and Down", "Ards and North Down", "Derry City and Strabane", "Mid Ulster",
            "Causeway Coast and Glens", "Antrim and Newtownabbey", "Lisburn and Castlereagh",
            "Mid and East Antrim", "Fermanagh and Omagh", "Overseas", "Not reported", "All employees"
        ],
        organisation: ["Attorney General's Office", "Crown Prosecution Service",
            "Crown Prosecution Service Inspectorate", "Government Legal Department", "Serious Fraud Office",
            "Department for Business, Energy and Industrial Strategy (excl. agencies)",
            "Advisory, Conciliation and Arbitration Service", "Companies House", "Insolvency Service",
            "Met Office", "UK Intellectual Property Office", "UK Space Agency",
            "Cabinet Office (excl. agencies)", "Crown Commercial Service", "Government Property Agency",
            "Government Actuary's Department", "National Savings and Investments", "Charity Commission",
            "Ministry of Housing, Communities and Local Government (excl. agencies)", "Planning Inspectorate",
            "Queen Elizabeth II Centre", "Competition and Markets Authority",
            "Department for Digital, Culture, Media and Sport", "Ministry of Defence (excl. agencies)",
            "Defence Science and Technology Laboratory", "Defence Electronics and Components Agency",
            "Defence Equipment and Support", "Royal Fleet Auxiliary", "Submarine Delivery Agency",
            "UK Hydrographic Office", "Department for International Trade",
            "Department for Education (excl. agencies)", "Education and Skills Funding Agency",
            "Institute for Apprenticeships and Technical Education", "Standards and Testing Agency",
            "Teaching Regulation Agency", "Department for Environment, Food and Rural Affairs (excl. agencies)",
            "Animal and Plant Health Agency", "Centre for Environment, Fisheries and Aquaculture Science",
            "Rural Payments Agency", "Veterinary Medicines Directorate", "ESTYN", "Food Standards Agency",
            "Foreign, Commonwealth and Development Office (excl. agencies)", "FCDO Services", "Wilton Park",
            "Department of Health and Social Care (excl. agencies)",
            "Medicines and Healthcare Products Regulatory Agency", "Public Health England", "HM Land Registry",
            "HM Revenue and Customs (excl. agencies)", "Valuation Office Agency",
            "HM Treasury (excl. agencies)", "Debt Management Office", "Government Internal Audit Agency",
            "National Infrastructure Commission", "Office for Budget Responsibility",
            "Home Office (incl. agencies)", "Ministry of Justice (excl. agencies)",
            "Criminal Injuries Compensation Authority", "HM Courts and Tribunals Service", "Legal Aid Agency",
            "HM Prison and Probation Service", "Office of the Public Guardian", "The National Archives",
            "National Crime Agency", "Northern Ireland Office",
            "Office for Standards in Education, Children's Services and Skills",
            "Office of Gas and Electricity Markets", "Office of Rail and Road",
            "Office of Qualifications and Examinations Regulation",
            "Scotland Office (incl. Office of the Advocate General for Scotland)",
            "Scottish Government (excl. agencies)", "Accountant in Bankruptcy",
            "Crown Office and Procurator Fiscal Service", "Disclosure Scotland", "Education Scotland",
            "Food Standards Scotland", "Forestry and Land Scotland", "National Records of Scotland",
            "Office of the Scottish Charity Regulator", "Registers of Scotland", "Revenue Scotland",
            "Scottish Courts and Tribunals Service", "Scottish Fiscal Commission", "Scottish Forestry",
            "Scottish Housing Regulator", "Scottish Prison Service", "Scottish Public Pensions Agency",
            "Social Security Scotland", "Student Awards Agency for Scotland", "Transport Scotland",
            "Department for Transport (excl. agencies)", "Driver and Vehicle Licensing Agency",
            "Driver and Vehicle Standards Agency", "Maritime and Coastguard Agency",
            "Vehicle Certification Agency", "United Kingdom Statistics Authority", "UK Export Finance",
            "UK Supreme Court", "Wales Office", "Water Services Regulation Authority",
            "Welsh Government (excl. agencies)", "Welsh Revenue Authority",
            "Department for Work and Pensions (excl. agencies)", "Health and Safety Executive",
            "Foreign and Commonwealth Office (excl. agencies)", "Department for International Development",
            "All employees"
        ],
        profession_of_post: ["Commercial", "Communications", "Corporate Finance", "Counter Fraud",
            "Digital, Data and Technology", "Economics", "Finance", "Human Resources",
            "Inspector of Education and Training", "Intelligence Analysis", "Internal Audit",
            "International Trade", "Knowledge and Information Management", "Legal", "Medicine",
            "Operational Delivery", "Operational Research", "Planning", "Planning Inspectors", "Policy",
            "Project Delivery", "Property", "Psychology", "Science and Engineering", "Security",
            "Social Research", "Statistics", "Tax", "Veterinarian", "Other", "Not reported", "All employees"
        ],
        religion_or_belief: ["Christian", "Buddhist", "Hindu", "Jewish", "Muslim", "Sikh", "Any other religion",
            "No religion", "Not declared", "Not reported", "All declared", "All employees"
        ],
        responsibility_level: ["Senior Civil Service Level", "Grades 6 and 7",
            "Senior and Higher Executive Officers", "Executive Officers",
            "Administrative Officers and Assistants", "Not reported", "All employees"
        ],
        salary_band: ["Up to £20,000", "£20,001 - 25,000", "£25,001 - 30,000", "£30,001 - 35,000",
            "£35,001 - 40,000", "£40,001 - 45,000", "£45,001 - 50,000", "£50,001 - 55,000", "£55,001 - 60,000",
            "£60,001 - 65,000", "£65,001 - 70,000", "£70,001 - 75,000", "£75,001 - 100,000",
            "£100,001 - 125,000", "£125,001 - 150,000", "£150,001+", "Not reported", "Greater than £100,000",
            "Greater than £150,000", "Greater than £200,000", "All employees"
        ],
        sex: ["Male", "Female", "All employees"],
        sexual_orientation: ["Bisexual", "Gay/Lesbian", "Heterosexual/Straight", "Other", "Not declared",
            "Not reported", "All declared", "All employees"
        ],
        transfer_type: ["Transfer of Function Within Civil Service", "Transfer To Another Department",
            "Loan To Another Department", "End Of Loan", "All employees"
        ],
        uk_region: ["North East", "North West", "Yorkshire and The Humber", "East Midlands", "West Midlands",
            "East of England", "London", "South East", "South West", "Wales", "Scotland", "Northern Ireland",
            "Overseas", "Not reported", "All employees"
        ],
        working_pattern: ["Full-time", "Part-time", "All employees", "All Employees"]
    }

    function select_table() {

        reset_categories()
        
        var table_selected = $("#filter_source_table").val();
        
        if ($("#filter_source_table option:selected").val() == "null") {
            $("#generate_table").hide();
            $("#filter_variable_group").hide();
            $("#filter_categories_group").hide();
            $("#add_category").hide();
            $("#reset_filters").hide();
            $("#filter_selections").hide();
        } else {
            $("#generate_table").show();
            $("#filter_categories_group").hide();
            $("#add_category").hide();
            $("#reset_filters").hide();
            $("#filter_categories").html("");
            $("#filter_selections").show();
        }

        let variables_html = "<option value='null'>Please select a category</option>";

        table_variables[table_selected].forEach(function(variable){
            variables_html += "<option value='" + variable + "'>" + variable_labels[variable] + "</option>";
        });

        $("#filter_variable").html(variables_html);

        $("#filter_variable_group").show();

    }

    function select_variable() {

        if ($("#filter_variable option:selected").val() == "null") {
            $("#filter_categories_group").hide();
            $("#filter_categories").html("");
            $("#add_category").hide();
            $("#reset_filters").hide();
            return
        }

        var_selected = $("#filter_variable").val();

        let options_html = "<option value='null'>Please select a category</option>";

        variable_categories[var_selected].forEach(function (category) {
            options_html += "<option value='" + category + "'>" + category + "</option>";
        });

        $("#filter_categories").html(options_html);

        $("#filter_categories_group").show();
        $("#add_category").show();

    }

    function select_category() {

        if ($("#filter_categories option:selected").val() == "null") {
            return
        }

        category_selections[var_selected] = $("#filter_categories option:selected").val();

        out_html = "<h4 class='govuk-heading-s'>Categories selected</h4><p class='govuk-body'>";
        out_html += "<ul class='govuk-list'>"

        Object.keys(category_selections).forEach(function (variable) {
            if (category_selections[variable] != "") {
                out_html += "<li>" + variable_labels[variable] + ": " + category_selections[variable] + "</li>";
                number_of_selections += 1
            }
        });

        out_html += "</ul></p>"

        if (number_of_selections == 0) {
            out_html = "<h4 class='govuk-heading-s'>No categories selected</h4>"
        }

        $("#filter_selections").html(out_html);
        $("#reset_filters").show();

    }

    function reset_categories() {
        number_of_selections = 0;
        Object.keys(category_selections).forEach(function (variable) {
            category_selections[variable] = ""
        });
        $("#filter_variable").val("null");
        $("#filter_categories").val("null");
        $("#filter_selections").html("<h4 class='govuk-heading-s'>No categories selected</h4>");
        $("#filter_categories_group").hide();
        $("#add_category").hide();
        $("#reset_filters").hide();
        $("#reset_filters").hide();
        $("#no_results").hide();
    }

    function filter_results() {

        filter_res = csv_data;

        filter_res = filter_res.filter(data => data.source_table == $("#filter_source_table option:selected").val());

        Object.keys(category_selections).forEach(function (variable) {
            if (category_selections[variable] != "") {
                filter_res = filter_res.filter(data => data[variable] == category_selections[variable]);
            }
        });

    }

    function generate_table() {

        filter_results();

        if (filter_res.length == 0) {
            $("#no_results").show();
            return;
        };

        $("#filter_results").hide();
        $("#filter_group").removeClass("govuk-form-group--error");
        $("#no_filters_msg").hide();

        let table_meta_html = "<strong class='govuk-!-font-weight-bold'>" + $("#filter_source_table option:selected").text() + "</strong>";
        let categories_meta_html = ""

        if (number_of_selections == 0) {
            categories_meta_html = ""
        } else {
            categories_meta_html = "<strong class='govuk-!-font-weight-bold'>Filters applied:</strong> "
            Object.keys(category_selections).forEach(function (variable) {
                if (category_selections[variable] != "") {
                    categories_meta_html += variable_labels[variable] + ": " + category_selections[variable] + "; ";
                }
            });
            categories_meta_html = categories_meta_html.substring(0, categories_meta_html.length - 2) + ".";
        }

        let table_html = "<table id='results_table' class='govuk-table govuk-!-font-size-14'>";

        /* Generate table header */
        table_html += "<thead class='govuk-table__head'><tr class='govuk-table__row'>";
        csv_columns.forEach(function (col_head) {
            table_html += "<th scope='col' class='govuk-table__header'>" +
                col_head.split('_').map(function (word) {
                    return (word.charAt(0).toUpperCase() + word.slice(1));
                }).join(' ').replace("Uk ", "UK ").replace(" Of ", " of ").replace(" Or ", " or ").replace(
                    "Nuts2", "NUTS 2").replace("Nuts3", "NUTS3") +
                "</th>";
        });
        table_html += "</tr></thead>";

        /*Generate table body*/
        table_html += "<tbody class='govuk-table__body'>";
        filter_res.forEach(function (row) {
            table_html += "<tr class='govuk-table__row'>";
            Object.values(row).forEach(function (cell) {
                table_html += "<td scope='row' class='govuk-table__cell'>" + cell + "</td>";
            });
            table_html += "</tr>";
        });
        table_html += "</tbody>"

        table_html += "</table>";

        var dt_dom = "";
        if (filter_res.length < 11){
            dt_dom = "<'govuk_dt_table't><'govuk_dt_nav'iB>";
        } else {
            dt_dom = "<'govuk_dt_table't><'govuk_dt_nav'piB>";
        }

        $("#results_meta_table").html(table_meta_html);
        $("#results_meta_categories").html(categories_meta_html);
        $("#results_container").html(table_html);
        $("#filter_results").show();
        $("#results_table").dataTable({
            dom: dt_dom,
            buttons: [{
                    extend: "copy",
                    title: function(){
                        var txt = "Civil Service Statistics 2021\r\n" + $("#filter_source_table option:selected").text();
                        if (number_of_selections > 0) {
                            txt += "\r\n" + categories_meta_html.substring(67, categories_meta_html.length - 1);
                        }
                        return (txt)
                    }
                },
                {
                    extend: "csv",
                    text: "Download",
                    filename: "civilservicestatistics2021_"+ $("#filter_source_table option:selected").val() +
                        "_filtered" + Date.now() + ".csv"
                }
            ],
            "columnDefs": [{
                "type": "num",
                "targets": 25,
                render: DataTable.render.number(",")

            }]
        });
        
        govuk_DT_styling();
        document.getElementById("filter_results").scrollIntoView();
        $("#filter_results").focus()

    }

    $("#filter_source_table").on("change", function () {
        select_table();
    });
    $("#filter_variable").on("change", function () {
        select_variable();
    });
    $("#add_category").on("click", function () {
        select_category();
    });
    $("#generate_table").on("click", function () {
        generate_table();
    });
    $("#reset_filters").on("click", function () {
        reset_categories();
    });
</script>